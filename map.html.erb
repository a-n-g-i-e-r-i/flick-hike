<div id="map"></div>
<div id="right-panel">
<div>
<b>Start:</b>
<form>
  <fieldset class="form-group">
    <label>Start</label>
    <input class="form-control" id="start" placeholder="starting address">
  </fieldset>
</form
<br>
<b>Waypoints:</b> <br>
<i>(Ctrl-Click for multiple selection)</i> <br>
<select multiple id="waypoints">
  <option value="City and County of San Francisco City Hall, United States, 1 Doctor Carlton B Goodlett Place, San Francisco, CA 94102">City and County of San Francisco City Hall, United States, 1 Doctor Carlton B Goodlett Place, San Francisco, CA 94102</option>
  <option value="EPIC Steak, 369 The Embarcadero, San Francisco, CA 94105">EPIC Steak, 369 The Embarcadero, San Francisco, CA 94105</option>
  <option value="City and County of San Francisco City Hall, United States, 1 Doctor Carlton B Goodlett Place, San Francisco, CA 94102">City and County of San Francisco City Hall, United States, 1 Doctor Carlton B Goodlett Place, San Francisco, CA 94102</option>
  <option value="Masons Grand Lodge of California, 1111 California Street, San Francisco, CA 94108">Masons Grand Lodge of California, 1111 California Street, San Francisco, CA 94108</option>
  <option value="800 Larkin, 800 Larkin Street, San Francisco, CA 94109">800 Larkin, 800 Larkin Street, San Francisco, CA 94109</option>
  <option value="The Randall Museum, 199 Museum Way, San Francisco, CA 94114">The Randall Museum, 199 Museum Way, San Francisco, CA 94114</option>
  <option value="555 Market St, San Francisco, CA 94105">555 Market St, San Francisco, CA 94105</option>
  <option value="200 Market St, San Francisco, CA 94111">200 Market St, San Francisco, CA 94111</option>
  <option value="Justin Herman Plaza, San Francisco Bay Trail, San Francisco, CA 94105">Justin Herman Plaza, San Francisco Bay Trail, San Francisco, CA 94105</option>
</select>
<br>
<form>
  <fieldset class="form-group">
    <label>End</label>
    <input class="form-control" id="end" placeholder="ending address">
  </fieldset>
</form>
<br>
  <input type="submit" id="submit">
</div>
<div id="directions-panel"></div>
</div>
<script>

function initMap() {
map.mapTypes.set(customMapTypeId, customMapType);
map.setMapTypeId(customMapTypeId);
}

  function initMap() {
    var customMapType = new google.maps.StyledMapType([
      {
        stylers: [
          {hue: '#000040'},
          {visibility: 'simplified'},
          {gamma: 0.5},
          {weight: 0.5}
        ]
      },
      {
        elementType: 'labels',
        stylers: [{visibility: 'off'}]
      },
      {
        featureType: 'water',
        stylers: [{color: '#000040'}]
      }
    ], {
      name: 'Custom Style'
    });
    var customMapTypeId = 'custom_style';
    var directionsService = new google.maps.DirectionsService;
    var directionsDisplay = new google.maps.DirectionsRenderer;
    var map = new google.maps.Map(document.getElementById('map'), {
      zoom: 12,
      center: {lat: 37.7833, lng: -122.431297},  // San Francisco
      mapTypeControlOptions: {
        mapTypeIds: [google.maps.MapTypeId.ROADMAP, customMapTypeId]
      }
    });

    var infoWindow = new google.maps.InfoWindow({map: map});
    ///////////////////////////////////
    // Try HTML5 geolocation.
    if (navigator.geolocation) {
      navigator.geolocation.getCurrentPosition(function(position) {
        var pos = {
          lat: position.coords.latitude,
          lng: position.coords.longitude
        };

        infoWindow.setPosition(pos);
        infoWindow.setContent('Location found.');
        map.setCenter(pos);
      }, function() {
        handleLocationError(true, infoWindow, map.getCenter());
      });
    } else {
      // Browser doesn't support Geolocation
      handleLocationError(false, infoWindow, map.getCenter());
    }
    /////////////////////////////////
    map.mapTypes.set(customMapTypeId, customMapType);
    map.setMapTypeId(customMapTypeId);

    directionsDisplay.setMap(map);

    document.getElementById('submit').addEventListener('click', function() {
      calculateAndDisplayRoute(directionsService, directionsDisplay);
    });
  }

  function handleLocationError(browserHasGeolocation, infoWindow, pos) {
    infoWindow.setPosition(pos);
    infoWindow.setContent(browserHasGeolocation ?
                          'Error: The Geolocation service failed.' :
                          'Error: Your browser doesn\'t support geolocation.');
  }

  function calculateAndDisplayRoute(directionsService, directionsDisplay) {
    var waypts = [];
    var checkboxArray = document.getElementById('waypoints');
    for (var i = 0; i < checkboxArray.length; i++) {
      if (checkboxArray.options[i].selected) {
        waypts.push({
          location: checkboxArray[i].value,
          stopover: true
        });
      }
    }

    directionsService.route({
      origin: document.getElementById('start').value,
      destination: document.getElementById('end').value,
      waypoints: waypts,
      optimizeWaypoints: true,
      travelMode: google.maps.TravelMode.WALKING
    }, function(response, status) {
      if (status === google.maps.DirectionsStatus.OK) {
        directionsDisplay.setDirections(response);
        var route = response.routes[0];
        var summaryPanel = document.getElementById('directions-panel');
        summaryPanel.innerHTML = '';
        // For each route, display summary information.
        for (var i = 0; i < route.legs.length; i++) {
          var routeSegment = i + 1;
          summaryPanel.innerHTML += '<b>Route Segment: ' + routeSegment +
              '</b><br>';
          summaryPanel.innerHTML += route.legs[i].start_address + ' to ';
          summaryPanel.innerHTML += route.legs[i].end_address + '<br>';
          summaryPanel.innerHTML += route.legs[i].distance.text + '<br><br>';
        }
      } else {
        window.alert('Directions request failed due to ' + status);
      }
    });
  }
</script>

<script src="https://maps.googleapis.com/maps/api/js?key=AIzaSyBwr64FZQ5ZTImLSjt5QHVKGyN4-teUNKk&signed_in=false&callback=initMap"
    async defer></script>
